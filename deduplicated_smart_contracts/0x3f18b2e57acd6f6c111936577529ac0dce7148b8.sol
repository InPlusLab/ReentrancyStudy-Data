/**

 *Submitted for verification at Etherscan.io on 2018-08-15

*/



pragma solidity ^0.4.23;



/**

 * @title ERC721 Non-Fungible Token Standard basic interface

 * @dev see https://github.com/ethereum/EIPs/blob/master/EIPS/eip-721.md

 */

contract ERC721Basic {

  event Transfer(

    address indexed _from,

    address indexed _to,

    uint256 _tokenId

  );

  event Approval(

    address indexed _owner,

    address indexed _approved,

    uint256 _tokenId

  );

  event ApprovalForAll(

    address indexed _owner,

    address indexed _operator,

    bool _approved

  );



  function balanceOf(address _owner) public view returns (uint256 _balance);

  function ownerOf(uint256 _tokenId) public view returns (address _owner);

  function exists(uint256 _tokenId) public view returns (bool _exists);



  function approve(address _to, uint256 _tokenId) public;

  function getApproved(uint256 _tokenId)

    public view returns (address _operator);



  function setApprovalForAll(address _operator, bool _approved) public;

  function isApprovedForAll(address _owner, address _operator)

    public view returns (bool);



  function transferFrom(address _from, address _to, uint256 _tokenId) public;

  function safeTransferFrom(address _from, address _to, uint256 _tokenId)

    public;



  function safeTransferFrom(

    address _from,

    address _to,

    uint256 _tokenId,

    bytes _data

  )

    public;

}



/**

 * @title ERC-721 Non-Fungible Token Standard, optional enumeration extension

 * @dev See https://github.com/ethereum/EIPs/blob/master/EIPS/eip-721.md

 */

contract ERC721Enumerable is ERC721Basic {

  function totalSupply() public view returns (uint256);

  function tokenOfOwnerByIndex(

    address _owner,

    uint256 _index

  )

    public

    view

    returns (uint256 _tokenId);



  function tokenByIndex(uint256 _index) public view returns (uint256);

}



/**

 * @title ERC-721 Non-Fungible Token Standard, optional metadata extension

 * @dev See https://github.com/ethereum/EIPs/blob/master/EIPS/eip-721.md

 */

contract ERC721Metadata is ERC721Basic {

  function name() public view returns (string _name);

  function symbol() public view returns (string _symbol);

  function tokenURI(uint256 _tokenId) public view returns (string);

}



/**

 * @title ERC-721 Non-Fungible Token Standard, full implementation interface

 * @dev See https://github.com/ethereum/EIPs/blob/master/EIPS/eip-721.md

 */

contract ERC721 is ERC721Basic, ERC721Enumerable, ERC721Metadata {

}



/**

 * @title Ownable

 * @dev The Ownable contract has an owner address, and provides basic authorization control

 * functions, this simplifies the implementation of "user permissions".

 */

contract Ownable {

  address public owner;





  event OwnershipRenounced(address indexed previousOwner);

  event OwnershipTransferred(

    address indexed previousOwner,

    address indexed newOwner

  );





  /**

   * @dev The Ownable constructor sets the original `owner` of the contract to the sender

   * account.

   */

  constructor() public {

    owner = msg.sender;

  }



  /**

   * @dev Throws if called by any account other than the owner.

   */

  modifier onlyOwner() {

    require(msg.sender == owner);

    _;

  }



  /**

   * @dev Allows the current owner to relinquish control of the contract.

   */

  function renounceOwnership() public onlyOwner {

    emit OwnershipRenounced(owner);

    owner = address(0);

  }



  /**

   * @dev Allows the current owner to transfer control of the contract to a newOwner.

   * @param _newOwner The address to transfer ownership to.

   */

  function transferOwnership(address _newOwner) public onlyOwner {

    _transferOwnership(_newOwner);

  }



  /**

   * @dev Transfers control of the contract to a newOwner.

   * @param _newOwner The address to transfer ownership to.

   */

  function _transferOwnership(address _newOwner) internal {

    require(_newOwner != address(0));

    emit OwnershipTransferred(owner, _newOwner);

    owner = _newOwner;

  }

}



/**

 * @title Pausable

 * @dev Base contract which allows children to implement an emergency stop mechanism.

 */

contract Pausable is Ownable {

  event Pause();

  event Unpause();



  bool public paused = false;





  /**

   * @dev Modifier to make a function callable only when the contract is not paused.

   */

  modifier whenNotPaused() {

    require(!paused);

    _;

  }



  /**

   * @dev Modifier to make a function callable only when the contract is paused.

   */

  modifier whenPaused() {

    require(paused);

    _;

  }



  /**

   * @dev called by the owner to pause, triggers stopped state

   */

  function pause() onlyOwner whenNotPaused public {

    paused = true;

    emit Pause();

  }



  /**

   * @dev called by the owner to unpause, returns to normal state

   */

  function unpause() onlyOwner whenPaused public {

    paused = false;

    emit Unpause();

  }

}



/**

 * @title Destructible

 * @dev Base contract that can be destroyed by owner. All funds in contract will be sent to the owner.

 */

contract Destructible is Ownable {



  constructor() public payable { }



  /**

   * @dev Transfers the current balance to the owner and terminates the contract.

   */

  function destroy() onlyOwner public {

    selfdestruct(owner);

  }



  function destroyAndSend(address _recipient) onlyOwner public {

    selfdestruct(_recipient);

  }

}





/**

 * @title CryptoArteSales

 * CryptoArteSales - a sales contract for CryptoArte non-fungible tokens 

 * corresponding to paintings from the www.cryptoarte.io collection

 */

contract CryptoArteSales is Ownable, Pausable, Destructible {



    event Sent(address indexed payee, uint256 amount, uint256 balance);

    event Received(address indexed payer, uint tokenId, uint256 amount, uint256 balance);



    ERC721 public nftAddress;

    uint256 public currentPrice;



    /**

    * @dev Contract Constructor

    * @param _nftAddress address for Crypto Arte non-fungible token contract 

    * @param _currentPrice initial sales price

    */

    constructor(address _nftAddress, uint256 _currentPrice) public { 

        require(_nftAddress != address(0) && _nftAddress != address(this));

        require(_currentPrice > 0);

        nftAddress = ERC721(_nftAddress);

        currentPrice = _currentPrice;

    }



    /**

    * @dev Purchase _tokenId

    * @param _tokenId uint256 token ID (painting number)

    */

    function purchaseToken(uint256 _tokenId) public payable whenNotPaused {

        require(msg.sender != address(0) && msg.sender != address(this));

        require(msg.value >= currentPrice);

        require(nftAddress.exists(_tokenId));

        address tokenSeller = nftAddress.ownerOf(_tokenId);

        nftAddress.safeTransferFrom(tokenSeller, msg.sender, _tokenId);

        emit Received(msg.sender, _tokenId, msg.value, address(this).balance);

    }



    /**

    * @dev send / withdraw _amount to _payee

    */

    function sendTo(address _payee, uint256 _amount) public onlyOwner {

        require(_payee != address(0) && _payee != address(this));

        require(_amount > 0 && _amount <= address(this).balance);

        _payee.transfer(_amount);

        emit Sent(_payee, _amount, address(this).balance);

    }    



    /**

    * @dev Updates _currentPrice

    * @dev Throws if _currentPrice is zero

    */

    function setCurrentPrice(uint256 _currentPrice) public onlyOwner {

        require(_currentPrice > 0);

        currentPrice = _currentPrice;

    }        



}